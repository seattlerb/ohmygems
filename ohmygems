# -*- sh -*-

ohmygems() {
    name=${1:-}

    if [ -z "${ORIG_GEM_PATH:-}" ]; then
        export ORIG_GEM_PATH=${GEM_PATH:-}
        export ORIG_GEM_HOME=${GEM_HOME:-}
        export ORIG_PATH=${PATH}
    fi

    if [ -z "$name" ]; then
        echo "usage: ohmygems <name or reset or env>"
        echo
        echo "  Switches gem home to a (potentially new) named repo."
        echo "  Your previous gems are still visible,"
        echo "  but new gem installs will install into ~/.gem/repos/<name>."
        echo "  Use 'reset' to go back to normal."
        echo "  Use 'env' to view environment information."
        echo
        echo "Available repos in ~/.gem/repos:"
        echo
        ls ~/.gem/repos | pr -o2 -l1
        echo
        return
    elif [ $name = "reset" ]; then
        echo Resetting repo

        if [ -z "$ORIG_GEM_HOME" ]; then
            unset GEM_HOME
        else
            GEM_HOME=${ORIG_GEM_HOME}
        fi

        GEM_PATH=${ORIG_GEM_PATH}
        PATH=$ORIG_PATH
        unset OMG_NAME
    elif [ $name = "env" ]; then
        echo Oh My Gems Environment

        echo GEM_PATH=${GEM_PATH:-not set}
        echo GEM_HOME=${GEM_HOME:-not set}
        echo PATH=$PATH
    else
        echo Switching to $name

        export GEM_HOME=~/.gem/repos/${name}
        export GEM_PATH=${ORIG_GEM_HOME}:${ORIG_GEM_PATH}
        export PATH=${ORIG_PATH}:${GEM_HOME}/bin

        [ -d $GEM_HOME ] || mkdir -p $GEM_HOME
        OMG_NAME=${name}
    fi
}

alias omg=ohmygems
